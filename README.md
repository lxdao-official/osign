# osign.sh

offer-sign 是一个链下的临时账簿服务，希望可以帮助你简单的构建无服务的 DAPPs。

他的核心是一个临时账簿结构，包含固定信息、增量信息、签名确认信息。

主要场景是链下的多人签名授权代理给发起人，然后由发起人上链校验，为他们生成信息或者执行操作。

## API Document

https://documenter.getpostman.com/view/5071586/2s8YzXuzUo

## 核心

- offer，一个 offer 是一个临时账簿，可以用来记录一笔交易，或者一笔转账，或者任何一种其他信息，
  - offer 的结构包括几个核心部分：uuid、发起人、固定信息区、增量信息区、签名区、status。
  - 固定信息区是由发起人定义的，是签名的主体内容，此区域信息一旦生成任何人都不可修改。
  - 增量信息区是一个 kv 结构，任何指定的签名人都可以写入信息，但是一旦写入某个 key，其他人就不能再写入此 key。
  - 签名区是一个数组，存储多人的签名信息。
  - offer 的状态会根据进度自动修改：创建、签名中、签名完成，可通过接口轮训 offer 状态。
- sign，对 offer 进行签名，可以指定多个签名地址，多人对 offer 完成签名后，签名信息将存入账簿，并且 offer 状态会变更为已完成签名。
  - 每个人签名的信息都是 uuid、发起人、固定信息区的字符串。
- verify，在链上提供工具合约方法对 offer 进行一步验证，验证 offer 的签名信息是否正确。

## 流程

- 任何地址都可以发起一个 offer，指定签名人数和地址，获得一个 offer id。
- 将 offer id 传递给签名人，签名人通过 offer id 获取 offer 信息，对 uuid、发起人、offer 固定信息区 进行签名。
- 签名人也可以主动请求待签名信息的列表。
- 后续可以根据此 id 查询 offer 详情或者使用发起人地址查询 offer 列表（分页）。
- 发起人刷新到 offer 的签名完成状态后，可以上链验证，链上提供工具合约方法进行一步验证。

## 说明

- 授权并非一次性的，针对某个信息的授权可以多次使用。
- 账簿是公开的，包括用户对账簿内容的签名，但是因为每个授权都是针对 发起人+ offer 信息的授权，其他人拿到了 B 和 C 的签名也是无用的，此签名只能用于验证此账簿信息，发起人也是限定的。

## 场景

如 A 发起一个订单，在链下获得 B 和 C 对此订单信息的签名（包括订单信息和发起人），在链上验证 B 和 C 对此订单进行了授权，从而执行一些链上的操作。

- marry3，A 发起求婚 offer，B 对此 offer 签名，并补充信息，完成后，A 上链验证，在链上合约为 A 和 B 颁发结婚证。
- 任务担保合约，需要三方共同发起一个担保订单，三方对此订单进行签名，完成后，发起人上链验证，此订单的担保合约生效。
- 任何需要链下多人交互生成一条信息上链的场景，不一定要签名校验，可以纯粹用于信息维系和更新，然后上链。
